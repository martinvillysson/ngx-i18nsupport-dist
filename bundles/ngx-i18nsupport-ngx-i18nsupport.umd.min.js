!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("stream"),require("chalk"),require("util"),require("fs"),require("@ngx-i18nsupport/ngx-i18nsupport-lib"),require("path"),require("rxjs"),require("rxjs/operators"),require("he"),require("request")):"function"==typeof define&&define.amd?define("@ngx-i18nsupport/ngx-i18nsupport",["exports","@angular/core","stream","chalk","util","fs","@ngx-i18nsupport/ngx-i18nsupport-lib","path","rxjs","rxjs/operators","he","request"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ngx-i18nsupport"]=t["ngx-i18nsupport"]||{},t["ngx-i18nsupport"]["ngx-i18nsupport"]={}),t.ng.core,t.stream,t.chalk,t.util,t.fs,t.ngxI18nsupportLib,t.path,t.rxjs,t.rxjs.operators,t.entityDecoderLib,t.request)}(this,(function(t,e,r,n,a,i,s,o,u,l,c,p){"use strict";function f(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function h(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var g=f(n),d=h(p),m=function(){};m.ɵmod=e.ɵɵdefineNgModule({type:m}),m.ɵinj=e.ɵɵdefineInjector({factory:function(t){return new(t||m)},imports:[[]]});
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function v(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}Object.create;function _(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(t){a={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function F(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(x(arguments[e]));return t}Object.create;function T(t){return null==t}function b(t){return Array.isArray(t)}var w,O=function(t){function e(){var e=t.call(this)||this;return e.resultString="",e}return v(e,t),e.prototype._write=function(t,e,r){var n;n="string"==typeof t?t:t instanceof Buffer?t.toString():Buffer.alloc(t).toString(e),this.resultString=this.resultString+n,r()},e.prototype.writtenData=function(){return this.resultString},e}(r.Writable);!function(t){t[t.ERROR=0]="ERROR",t[t.WARN=1]="WARN",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG"}(w||(w={}));var S=function(){function t(t){this._quiet=!1,this._verbose=!1,this.outputStream=t||process.stdout}return t.prototype.setVerbose=function(){this._verbose=!0},t.prototype.setQuiet=function(){this._quiet=!0},t.prototype.verbose=function(){return this._verbose},t.prototype.quiet=function(){return this._quiet},t.prototype.error=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(w.ERROR,t,e)},t.prototype.warn=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(w.WARN,t,e)},t.prototype.info=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(w.INFO,t,e)},t.prototype.debug=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.log(w.DEBUG,t,e)},t.prototype.log=function(t,e,r){if(this.isOutputEnabled(t)){var n;switch(t){case w.ERROR:n=g.default.red("ERROR: "+e);break;case w.WARN:n=g.default.magenta("WARNING: "+e);break;default:n=g.default.gray("* "+e)}var i=a.format.apply(void 0,F([n],r));this.outputStream.write(i+"\n")}},t.prototype.isOutputEnabled=function(t){var e,r;switch(this._quiet&&this._verbose?(e=!1,r=!1):(e=this._quiet,r=this._verbose),t){case w.ERROR:return!0;case w.WARN:return!e;case w.INFO:return r&&!e;case w.DEBUG:return r;default:return!0}},t}(),E=function(t){function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return v(e,t),e}(Error),P=function(){function t(){}return t.exists=function(t){return i.existsSync(t)},t.read=function(t,e){return i.readFileSync(t,e)},t.replaceContent=function(t,e,r){i.writeFileSync(t,e,{encoding:r})},t.copy=function(t,e){for(var r=Buffer.alloc(65536),n=i.openSync(t,"r"),a=i.openSync(e,"w"),s=1,o=0;s>0;)s=i.readSync(n,r,0,65536,o),i.writeSync(a,r,0,s),o+=s;i.closeSync(n),i.closeSync(a)},t.deleteFolderRecursive=function(e){i.existsSync(e)&&(i.readdirSync(e).forEach((function(r){var n=e+"/"+r;i.lstatSync(n).isDirectory()?t.deleteFolderRecursive(n):i.unlinkSync(n)})),i.rmdirSync(e))},t.deleteFolderContentRecursive=function(e){i.existsSync(e)&&i.readdirSync(e).forEach((function(r){var n=e+"/"+r;i.lstatSync(n).isDirectory()?t.deleteFolderRecursive(n):i.unlinkSync(n)}))},t.deleteFile=function(t){i.unlinkSync(t)},t}(),I=function(){function t(t){this.extractionPatternString=t;var e=t.split("|");this._matchExplicitId=!1,this._descriptionPatterns=[];for(var r=0;r<e.length;r++){var n=e[r];if("@@"===n){if(this._matchExplicitId)throw new Error("extraction pattern must not contain @@ twice");this._matchExplicitId=!0}else{var a=this.checkValidDescriptionPattern(n);if(a)throw new Error(a);this._descriptionPatterns.push(n)}}}return t.prototype.isExplicitIdMatched=function(t){return t&&this._matchExplicitId},t.prototype.isDescriptionMatched=function(t){return this._descriptionPatterns.indexOf(t)>=0},t.prototype.checkValidDescriptionPattern=function(t){return t?/^[a-zA-Z_][a-zA-Z_-]*$/.test(t)?null:"description pattern must be an identifier containing only letters, digits, _ or -":"empty value not allowed"},t}(),U=function(){function t(t,e){this.messagesFile=t,this.extractionPattern=new I(e)}return t.checkPattern=function(t){try{if(new I(t))return null}catch(t){return t.message}return null},t.extract=function(e,r,n){new t(e,r).extractTo(n)},t.prototype.extractTo=function(t){var e=this.toNgxTranslations(this.extract());e&&Object.keys(e).length>0?P.replaceContent(t,JSON.stringify(e,null,4),"UTF-8"):P.exists(t)&&P.deleteFile(t)},t.prototype.extract=function(){var t=this,e=[];return this.messagesFile.forEachTransUnit((function(r){var n=t.ngxTranslateIdFromTU(r);if(n){var a=r.targetContentNormalized().asDisplayString(s.NORMALIZATION_FORMAT_NGXTRANSLATE);e.push({id:n,message:a})}})),e},t.prototype.ngxTranslateIdFromTU=function(t){if(this.isExplicitlySetId(t.id))return this.extractionPattern.isExplicitIdMatched(t.id)?t.id:null;var e=t.description();return e&&this.extractionPattern.isDescriptionMatched(e)?t.meaning():void 0},t.prototype.isExplicitlySetId=function(t){if(T(t))return!1;return!/^[0-9a-f]{11,}$/.test(t)},t.prototype.toNgxTranslations=function(t){var e=this,r={};return t.forEach((function(t){e.putInTranslationObject(r,t)})),r},t.prototype.putInTranslationObject=function(t,e){var r,n,a=e.id.indexOf(".");if(0===a||a===e.id.length-1)throw new Error('bad nxg-translate id "'+e.id+'"');a<0?(r=e.id,n=""):(r=e.id.substring(0,a),n=e.id.substring(a+1));var i=t[r];if(T(i)){if(""===n)return void(t[r]=e.message);i={},t[r]=i}else if(""===n)throw new Error('duplicate id praefix "'+e.id+'"');this.putInTranslationObject(i,{id:n,message:e.message})},t}();U.DefaultExtractionPattern="@@|ngx-translate";var N=["package.json",".angular-cli.json"],A=function(){function t(){this.errorsFound=[],this.warningsFound=[]}return t.createFromOptions=function(e,r){var n=new t;return n.configure(e,r),n},t.readProfileCandidate=function(t){var e;try{e=i.readFileSync(t,"UTF-8")}catch(t){return null}var r=JSON.parse(e);return r&&r.xliffmergeOptions?r:null},t.prototype.configure=function(t,e){this.errorsFound=[],this.warningsFound=[],e||(e=this.readProfile(t));var r=!!e;t.quiet&&(this._quiet=t.quiet),t.verbose&&(this._verbose=t.verbose),r&&(this.initializeFromConfig(e),t.languages&&t.languages.length>0&&(this._languages=t.languages,this._defaultLanguage||(this._defaultLanguage=this._languages[0])),this.checkParameters())},t.prototype.readProfile=function(e){var r,n,a,s=e.profilePath;if(!s){try{for(var o=_(N),u=o.next();!u.done;u=o.next()){var l=u.value,c=t.readProfileCandidate(l);if(c)return this.usedProfilePath=l,c}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return{}}try{a=i.readFileSync(s,"UTF-8")}catch(t){return this.errorsFound.push(new E('could not read profile "'+s+'"')),null}this.usedProfilePath=s;var p=JSON.parse(a),f=p.xliffmergeOptions;return f.srcDir=this.adjustPathToProfilePath(s,f.srcDir),f.genDir=this.adjustPathToProfilePath(s,f.genDir),f.optionalMasterFilePath&&(f.optionalMasterFilePath=this.adjustPathToProfilePath(s,f.optionalMasterFilePath)),f.apikeyfile=this.adjustPathToProfilePath(s,f.apikeyfile),p},t.prototype.adjustPathToProfilePath=function(t,e){return!e||o.isAbsolute(e)?e:o.join(o.dirname(t),e).replace(/\\/g,"/")},t.prototype.initializeFromConfig=function(t){if(t){var e=t.xliffmergeOptions;e?(T(e.quiet)||(this._quiet=e.quiet),T(e.verbose)||(this._verbose=e.verbose),T(e.allowIdChange)||(this._allowIdChange=e.allowIdChange),e.defaultLanguage&&(this._defaultLanguage=e.defaultLanguage),e.languages&&(this._languages=e.languages),e.srcDir&&(this._srcDir=e.srcDir),e.angularCompilerOptions&&e.angularCompilerOptions.genDir&&(this._genDir=e.angularCompilerOptions.genDir),e.genDir&&(this._genDir=e.genDir),e.optionalMasterFilePath&&(this._optionalMasterFilePath=e.optionalMasterFilePath),e.i18nBaseFile&&(this._i18nBaseFile=e.i18nBaseFile),e.i18nFile&&(this._i18nFile=e.i18nFile),e.i18nFormat&&(this._i18nFormat=e.i18nFormat),e.encoding&&(this._encoding=e.encoding),T(e.removeUnusedIds)||(this._removeUnusedIds=e.removeUnusedIds),T(e.supportNgxTranslate)||(this._supportNgxTranslate=e.supportNgxTranslate),T(e.ngxTranslateExtractionPattern)||(this._ngxTranslateExtractionPattern=e.ngxTranslateExtractionPattern),T(e.useSourceAsTarget)||(this._useSourceAsTarget=e.useSourceAsTarget),T(e.targetPraefix)||(this._targetPraefix=e.targetPraefix),T(e.targetSuffix)||(this._targetSuffix=e.targetSuffix),T(e.autotranslate)||(this._autotranslate=e.autotranslate),T(e.beautifyOutput)||(this._beautifyOutput=e.beautifyOutput),T(e.preserveOrder)||(this._preserveOrder=e.preserveOrder),T(e.apikey)||(this._apikey=e.apikey),T(e.apikeyfile)||(this._apikeyfile=e.apikeyfile)):this.warningsFound.push('did not find "xliffmergeOptions" in profile, using defaults')}},t.prototype.checkParameters=function(){var t,e,r=this;this.checkLanguageSyntax(this.defaultLanguage()),0===this.languages().length&&this.errorsFound.push(new E("no languages specified")),this.languages().forEach((function(t){r.checkLanguageSyntax(t)}));try{t=i.statSync(this.srcDir())}catch(t){e=t}!e&&t.isDirectory()||this.errorsFound.push(new E('srcDir "'+this.srcDir()+'" is not a directory'));try{t=i.statSync(this.genDir())}catch(t){e=t}!e&&t.isDirectory()||this.errorsFound.push(new E('genDir "'+this.genDir()+'" is not a directory'));try{i.accessSync(this.i18nFile(),i.constants.R_OK)}catch(e){this.errorsFound.push(new E('i18nFile "'+this.i18nFile()+'" is not readable'))}if("xlf"!==this.i18nFormat()&&"xlf2"!==this.i18nFormat()&&"xmb"!==this.i18nFormat()&&this.errorsFound.push(new E('i18nFormat "'+this.i18nFormat()+'" invalid, must be "xlf" or "xlf2" or "xmb"')),this.autotranslate()&&!this.apikey()&&this.errorsFound.push(new E("autotranslate requires an API key, please set one")),this.autotranslatedLanguages().forEach((function(t){r.languages().indexOf(t)<0&&r.errorsFound.push(new E('autotranslate language "'+t+'" is not in list of languages')),t===r.defaultLanguage()&&r.errorsFound.push(new E('autotranslate language "'+t+'" cannot be translated, because it is the source language'))})),this.supportNgxTranslate()){var n=U.checkPattern(this.ngxTranslateExtractionPattern());T(n)||this.errorsFound.push(new E('ngxTranslateExtractionPattern "'+this.ngxTranslateExtractionPattern()+'": '+n))}this.useSourceAsTarget()||(this.targetPraefix().length>0&&this.warningsFound.push('configured targetPraefix "'+this.targetPraefix()+'" will not be used because "useSourceAsTarget" is disabled"'),this.targetSuffix().length>0&&this.warningsFound.push('configured targetSuffix "'+this.targetSuffix()+'" will not be used because "useSourceAsTarget" is disabled"'))},t.prototype.checkLanguageSyntax=function(t){/^[a-zA-Z]{1,8}([-_][a-zA-Z0-9]{1,8})*$/.test(t)||this.errorsFound.push(new E('language "'+t+'" is not valid'))},t.prototype.allowIdChange=function(){return!T(this._allowIdChange)&&this._allowIdChange},t.prototype.optionalMasterFilePath=function(t){return t?this._optionalMasterFilePath?this._optionalMasterFilePath.replace("."+this.i18nFormat(),"."+t+"."+this.i18nFormat()):null:this._optionalMasterFilePath},t.prototype.verbose=function(){return!T(this._verbose)&&this._verbose},t.prototype.quiet=function(){return!T(this._quiet)&&this._quiet},t.prototype.showAllParameters=function(t){var e,r;t.debug("xliffmerge Used Parameters:"),t.debug('usedProfilePath:\t"%s"',this.usedProfilePath),t.debug('defaultLanguage:\t"%s"',this.defaultLanguage()),t.debug('srcDir:\t"%s"',this.srcDir()),t.debug('genDir:\t"%s"',this.genDir()),t.debug('optionalMasterFilePath:\t"%s"',this.optionalMasterFilePath()),t.debug('i18nBaseFile:\t"%s"',this.i18nBaseFile()),t.debug('i18nFile:\t"%s"',this.i18nFile()),t.debug("languages:\t%s",this.languages());try{for(var n=_(this.languages()),a=n.next();!a.done;a=n.next()){var i=a.value;t.debug("outputFile[%s]:\t%s",i,this.generatedI18nFile(i))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}t.debug("removeUnusedIds:\t%s",this.removeUnusedIds()),t.debug("supportNgxTranslate:\t%s",this.supportNgxTranslate()),this.supportNgxTranslate()&&t.debug("ngxTranslateExtractionPattern:\t%s",this.ngxTranslateExtractionPattern()),t.debug("useSourceAsTarget:\t%s",this.useSourceAsTarget()),this.useSourceAsTarget()&&(t.debug('targetPraefix:\t"%s"',this.targetPraefix()),t.debug('targetSuffix:\t"%s"',this.targetSuffix())),t.debug("allowIdChange:\t%s",this.allowIdChange()),t.debug("beautifyOutput:\t%s",this.beautifyOutput()),t.debug("preserveOrder:\t%s",this.preserveOrder()),t.debug("autotranslate:\t%s",this.autotranslate()),this.autotranslate()&&(t.debug("autotranslated languages:\t%s",this.autotranslatedLanguages()),t.debug("apikey:\t%s",this.apikey()?"****":"NOT SET"),t.debug("apikeyfile:\t%s",this.apikeyfile()))},t.prototype.defaultLanguage=function(){return this._defaultLanguage?this._defaultLanguage:"en"},t.prototype.languages=function(){return this._languages?this._languages:[]},t.prototype.srcDir=function(){return this._srcDir?this._srcDir:"."},t.prototype.i18nBaseFile=function(){return this._i18nBaseFile?this._i18nBaseFile:"messages"},t.prototype.i18nFile=function(){return o.join(this.srcDir(),this._i18nFile?this._i18nFile:this.i18nBaseFile()+"."+this.suffixForGeneratedI18nFile()).replace(/\\/g,"/")},t.prototype.i18nFormat=function(){return this._i18nFormat?this._i18nFormat:"xlf"},t.prototype.generatedI18nFile=function(t){return o.join(this.genDir(),this.i18nBaseFile()+"."+t+"."+this.suffixForGeneratedI18nFile()).replace(/\\/g,"/")},t.prototype.suffixForGeneratedI18nFile=function(){switch(this.i18nFormat()){case"xlf":case"xlf2":return"xlf";case"xmb":return"xtb"}},t.prototype.generatedNgxTranslateFile=function(t){return o.join(this.genDir(),this.i18nBaseFile()+"."+t+".json").replace(/\\/g,"/")},t.prototype.encoding=function(){return this._encoding?this._encoding:"UTF-8"},t.prototype.genDir=function(){return this._genDir?this._genDir:this.srcDir()},t.prototype.removeUnusedIds=function(){return!!T(this._removeUnusedIds)||this._removeUnusedIds},t.prototype.supportNgxTranslate=function(){return!T(this._supportNgxTranslate)&&this._supportNgxTranslate},t.prototype.ngxTranslateExtractionPattern=function(){return T(this._ngxTranslateExtractionPattern)?U.DefaultExtractionPattern:this._ngxTranslateExtractionPattern},t.prototype.useSourceAsTarget=function(){return!!T(this._useSourceAsTarget)||this._useSourceAsTarget},t.prototype.targetPraefix=function(){return T(this._targetPraefix)?"":this._targetPraefix},t.prototype.targetSuffix=function(){return T(this._targetSuffix)?"":this._targetSuffix},t.prototype.beautifyOutput=function(){return!T(this._beautifyOutput)&&this._beautifyOutput},t.prototype.preserveOrder=function(){return!!T(this._preserveOrder)||this._preserveOrder},t.prototype.autotranslate=function(){return!T(this._autotranslate)&&(b(this._autotranslate)?this._autotranslate.length>0:this._autotranslate)},t.prototype.autotranslateLanguage=function(t){return this.autotranslatedLanguages().indexOf(t)>=0},t.prototype.autotranslatedLanguages=function(){return T(this._autotranslate)||!1===this._autotranslate?[]:b(this._autotranslate)?this._autotranslate:this.languages().slice(1)},t.prototype.apikey=function(){if(T(this._apikey)){var t=this.apikeyfile();if(this.apikeyfile()){if(i.existsSync(t))return P.read(t,"utf-8");throw new Error(a.format("api key file not found: API_KEY_FILE=%s",t))}return null}return this._apikey},t.prototype.apikeyfile=function(){return this._apikeyfile?this._apikeyfile:process.env.API_KEY_FILE?process.env.API_KEY_FILE:null},t}(),C=null;try{C=require(o.resolve(__dirname,"..","package.json"))}catch(t){try{C=require(o.resolve(__dirname,"..","..","package.json"))}catch(t){C=null}}var M=C?C.version:"unknown",D=function(){function t(){}return t.readXmlFileContent=function(e,r){r||(r=t.DEFAULT_ENCODING);var n=P.read(e,r),a=t.encodingFromXml(n);return a!==r&&(n=P.read(e,a)),{content:n,encoding:a}},t.encodingFromXml=function(t){var e=t.indexOf('encoding="');if(e<0)return this.DEFAULT_ENCODING;var r=t.indexOf('"',e+10);return t.substring(e+10,r)},t}();D.DEFAULT_ENCODING="UTF-8";var k=function(){function t(){}return t.fromFile=function(e,r,n,a){var i=D.readXmlFileContent(r,n),o=t.masterFileContent(a,n);return s.TranslationMessagesFileFactory.fromFileContent(e,i.content,r,i.encoding,o)},t.fromUnknownFormatFile=function(e,r,n){var a=D.readXmlFileContent(e,r),i=t.masterFileContent(n,r);return s.TranslationMessagesFileFactory.fromUnknownFormatFileContent(a.content,e,a.encoding,i)},t.masterFileContent=function(t,e){if(t){var r=D.readXmlFileContent(t,e);return{xmlContent:r.content,path:t,encoding:r.encoding}}return null},t.save=function(t,e){P.replaceContent(t.filename(),t.editedContent(e),t.encoding())},t}(),L=function(){function t(t){this._request=d,this._apiKey=t,this._rootUrl="https://translation.googleapis.com/"}return t.stripRegioncode=function(t){for(var e=t.toLowerCase(),r=0;r<e.length;r++){var n=e.charAt(r);if(n<"a"||n>"z")return e.substring(0,r)}return e},t.prototype.setApiKey=function(t){this._apiKey=t},t.prototype.translateMultipleStrings=function(e,r,n){var a=this;if(0===e.length)return u.of([]);if(!this._apiKey)return u.throwError("cannot autotranslate: no api key");if(!r||!n)return u.throwError("cannot autotranslate: source and target language must be set");r=t.stripRegioncode(r),n=t.stripRegioncode(n);var i=this.splitMessagesToGoogleLimit(e).map((function(t){return a.limitedTranslateMultipleStrings(t,r,n)}));return u.forkJoin(i).pipe(l.map((function(t){for(var e=[],r=0;r<t.length;r++)e=e.concat(t[r]);return e})))},t.prototype.splitMessagesToGoogleLimit=function(t){if(t.length<=128)return[t];for(var e=[],r=[],n=0,a=0;a<t.length;a++)r.push(t[a]),++n>=128&&(e.push(r),r=[],n=0);return r.length>0&&e.push(r),e},t.prototype.limitedTranslateMultipleStrings=function(t,e,r){var n=this._rootUrl+"language/translate/v2?key="+this._apiKey,i={url:n,body:{q:t,target:r,source:e},json:!0};return this.post(n,i).pipe(l.map((function(t){var n=t.body;if(!n)throw new Error("no result received");if(n.error){if(400===n.error.code){if("Invalid Value"===n.error.message)throw new Error(a.format('Translation from "%s" to "%s" not supported',e,r));throw new Error(a.format("Invalid request: %s",n.error.message))}throw new Error(a.format("Error %s: %s",n.error.code,n.error.message))}return n.data.translations.map((function(t){return t.translatedText}))})))},t.prototype.post=function(t,e){return this._call.apply(this,[].concat("post",t,Object.assign({},e||{})))},t.prototype._call=function(t,e,r){var n=this;return u.Observable.create((function(a){var i=[].concat(e,Object.assign({},r||{}),(function(t,e,r){if(t)return a.error(t);a.next(Object.assign({},{response:e,body:r})),a.complete()}));try{n._request[t].apply(n._request,i)}catch(t){a.error(t)}}))},t}(),R=function(){function t(t,e){this._success=t,this._details=e}return t.prototype.success=function(){return this._success},t}(),q=function(){function t(t,e){this._from=t,this._to=e,this._total=0,this._ignored=0,this._success=0,this._failed=0}return t.prototype.setError=function(t,e){this._error=t,this._total=e,this._failed=e},t.prototype.error=function(){return this._error},t.prototype.setIgnored=function(t){this._total+=t,this._ignored=t},t.prototype.addSingleResult=function(t,e){this._total++,e.success()?this._success++:this._failed++},t.prototype.merge=function(t){this._error||(this._error=t._error),this._total+=t.total(),this._ignored+=t.ignored(),this._success+=t.success(),this._failed+=t.failed()},t.prototype.total=function(){return this._total},t.prototype.ignored=function(){return this._ignored},t.prototype.success=function(){return this._success},t.prototype.failed=function(){return this._failed},t.prototype.content=function(){return this._error?a.format('Auto translation from "%s" to "%s" failed: "%s", failed units: %s',this._from,this._to,this._error,this._failed):a.format('Auto translation from "%s" to "%s", total auto translated units: %s, ignored: %s, succesful: %s, failed: %s',this._from,this._to,this._total,this._ignored,this._success,this._failed)},t}(),j=function(){function t(t){this.autoTranslateService=new L(t)}return t.prototype.autoTranslate=function(t,e,r){return u.forkJoin(F([this.doAutoTranslateNonICUMessages(t,e,r)],this.doAutoTranslateICUMessages(t,e,r))).pipe(l.map((function(t){for(var e=t[0],r=1;r<t.length;r++)e.merge(t[r]);return e})))},t.prototype.allUntranslatedTUs=function(t){var e=[];return t.forEachTransUnit((function(t){t.targetState()===s.STATE_NEW&&e.push(t)})),e},t.prototype.doAutoTranslateNonICUMessages=function(t,e,r){var n=this,a=this.allUntranslatedTUs(r),i=a.filter((function(t){return T(t.sourceContentNormalized().getICUMessage())})),s=i.map((function(t){return t.sourceContentNormalized().asDisplayString()}));return this.autoTranslateService.translateMultipleStrings(s,t,e).pipe(l.map((function(t){return t.map((function(t){return c.decode(t)}))})),l.map((function(r){var s=new q(t,e);s.setIgnored(a.length-i.length);for(var o=0;o<r.length;o++){var u=i[o],l=r[o],c=n.autoTranslateNonICUUnit(u,l);s.addSingleResult(u,c)}return s})),l.catchError((function(r){var n=new q(t,e);return n.setError(r.message,s.length),u.of(n)})))},t.prototype.doAutoTranslateICUMessages=function(t,e,r){var n=this;return this.allUntranslatedTUs(r).filter((function(t){return!T(t.sourceContentNormalized().getICUMessage())})).map((function(r){return n.doAutoTranslateICUMessage(t,e,r)}))},t.prototype.doAutoTranslateICUMessage=function(t,e,r){var n=this,a=r.sourceContentNormalized().getICUMessage().getCategories();if(a.find((function(t){return!T(t.getMessageNormalized().getICUMessage())}))){var i=new q(t,e);return i.setIgnored(1),u.of(i)}var s=a.map((function(t){return t.getMessageNormalized().asDisplayString()}));return this.autoTranslateService.translateMultipleStrings(s,t,e).pipe(l.map((function(t){return t.map((function(t){return c.decode(t)}))})),l.map((function(i){for(var s=new q(t,e),o={},u=0;u<i.length;u++)o[a[u].getCategory()]=i[u];var l=n.autoTranslateICUUnit(r,o);return s.addSingleResult(r,l),s})),l.catchError((function(r){var n=new q(t,e);return n.setError(r.message,s.length),u.of(n)})))},t.prototype.autoTranslateNonICUUnit=function(t,e){return this.autoTranslateUnit(t,t.sourceContentNormalized().translate(e))},t.prototype.autoTranslateICUUnit=function(t,e){return this.autoTranslateUnit(t,t.sourceContentNormalized().translateICUMessage(e))},t.prototype.autoTranslateUnit=function(t,e){var r=e.validate(),n=e.validateWarnings();return T(r)?T(n)?(t.translate(e),new R(!0,null)):new R(!1,"warnings detected, not translated"):new R(!1,"errors detected, not translated")},t}(),z=function(){function t(t,e){this.commandOutput=t,this.options=e,this.parameters=null}return t.main=function(e){var r=t.parseArgs(e);r&&new t(new S(process.stdout),r).run((function(t){process.exit(t)}))},t.parseArgs=function(e){for(var r,n={languages:[]},a=1;a<e.length;a++){var i=e[a];if("--version"===i||"-version"===i)console.log("xliffmerge "+M);else if("--verbose"===i||"-v"===i)n.verbose=!0;else if("--profile"===i||"-p"===i){if(++a>=e.length)return console.log("missing config file"),t.showUsage(),null;n.profilePath=e[a]}else if("--quiet"===i||"-q"===i)n.quiet=!0;else if("--language"===i||"-l"===i){if(++a>=e.length)return console.log("missing language"),null;if(-1!==e[a].indexOf(",")){var s=e[a].split(",");(r=n.languages).push.apply(r,F(s))}else n.languages.push(e[a])}else if("--help"===i||"-help"===i||"-h"===i)t.showUsage();else if(i.length>0&&"-"===i.charAt(0))return console.log("unknown option"),null}return n},t.showUsage=function(){console.log("usage: xliffmerge <option>* <language>*"),console.log("Options"),console.log("\t-p|--profile a json configuration file containing all relevant parameters."),console.log("\t\tfor details please consult the home page https://github.com/martinroob/ngx-i18nsupport"),console.log("\t-v|--verbose show some output for debugging purposes"),console.log("\t-q|--quiet only show errors, nothing else"),console.log("\t-version|--version show version string"),console.log(""),console.log('\t<language> has to be a valid language short string, e,g. "en", "de", "de-ch"')},t.createFromOptions=function(e,r,n){var a=new t(e,r);return a.parameters=A.createFromOptions(r,n),a},t.prototype.run=function(t,e){this.runAsync().subscribe((function(e){T(t)||t(e)}),(function(t){T(e)||e(t)}))},t.prototype.runAsync=function(){var t,e,r,n,a=this;if(this.options&&this.options.quiet&&this.commandOutput.setQuiet(),this.options&&this.options.verbose&&this.commandOutput.setVerbose(),this.parameters||(this.parameters=A.createFromOptions(this.options)),this.commandOutput.info("xliffmerge version %s",M),this.parameters.verbose()&&this.parameters.showAllParameters(this.commandOutput),this.parameters.errorsFound.length>0){try{for(var i=_(this.parameters.errorsFound),s=i.next();!s.done;s=i.next()){var o=s.value;this.commandOutput.error(o.message)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return u.of(-1)}if(this.parameters.warningsFound.length>0)try{for(var c=_(this.parameters.warningsFound),p=c.next();!p.done;p=c.next()){var f=p.value;this.commandOutput.warn(f)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}this.readMaster(),this.parameters.autotranslate()&&(this.autoTranslateService=new j(this.parameters.apikey()));var h=[];return this.parameters.languages().forEach((function(t){h.push(a.processLanguage(t))})),u.forkJoin(h).pipe(l.map((function(t){return a.totalRetcode(t)})))},t.prototype.totalRetcode=function(t){for(var e=0;e<t.length;e++)if(0!==t[e])return t[e];return 0},t.prototype.generatedI18nFile=function(t){return this.parameters.generatedI18nFile(t)},t.prototype.generatedNgxTranslateFile=function(t){return this.parameters.generatedNgxTranslateFile(t)},t.prototype.warnings=function(){return this.parameters.warningsFound},t.prototype.readMaster=function(){var t=this;try{this.master=k.fromFile(this.parameters.i18nFormat(),this.parameters.i18nFile(),this.parameters.encoding()),this.master.warnings().forEach((function(e){t.commandOutput.warn(e)}));var e=this.master.numberOfTransUnits(),r=this.master.numberOfTransUnitsWithMissingId();this.commandOutput.info("master contains %s trans-units",e),r>0&&this.commandOutput.warn("master contains %s trans-units, but there are %s without id",e,r);var n=this.master.sourceLanguage();n&&n!==this.parameters.defaultLanguage()&&(this.commandOutput.warn('master says to have source-language="%s", should be "%s" (your defaultLanguage)',n,this.parameters.defaultLanguage()),this.master.setSourceLanguage(this.parameters.defaultLanguage()),k.save(this.master,this.parameters.beautifyOutput()),this.commandOutput.warn('changed master source-language="%s" to "%s"',n,this.parameters.defaultLanguage()))}catch(t){if(t instanceof E)return this.commandOutput.error(t.message),u.of(-1);var i=this.parameters.i18nFile(),s=i?a.format('file "%s", ',i):"";throw this.commandOutput.error(s+"oops "+t),t}},t.prototype.processLanguage=function(t){var e=this;this.commandOutput.debug("processing language %s",t);var r=this.parameters.generatedI18nFile(t),n=r;return(P.exists(r)?this.mergeMasterTo(t,r):this.createUntranslatedXliff(t,r)).pipe(l.map((function(){if(e.parameters.supportNgxTranslate()){var n=k.fromFile(e.translationFormat(e.parameters.i18nFormat()),r,e.parameters.encoding(),e.master.filename());U.extract(n,e.parameters.ngxTranslateExtractionPattern(),e.parameters.generatedNgxTranslateFile(t))}return 0})),l.catchError((function(t){if(t instanceof E)return e.commandOutput.error(t.message),u.of(-1);var r=n?a.format('file "%s", ',n):"";throw e.commandOutput.error(r+"oops "+t),t})))},t.prototype.createUntranslatedXliff=function(t,e){var r,n=this,a=t===this.parameters.defaultLanguage();this.master.setNewTransUnitTargetPraefix(this.parameters.targetPraefix()),this.master.setNewTransUnitTargetSuffix(this.parameters.targetSuffix()),this.parameters.optionalMasterFilePath(t)&&(r=k.masterFileContent(this.parameters.optionalMasterFilePath(t),this.parameters.encoding()));var i=this.master.createTranslationFileForLang(t,e,a,this.parameters.useSourceAsTarget(),r);return this.autoTranslate(this.master.sourceLanguage(),t,i).pipe(l.map((function(){return k.save(i,n.parameters.beautifyOutput()),n.commandOutput.info('created new file "%s" for target-language="%s"',e,t),a||n.commandOutput.warn('please translate file "%s" to target-language="%s"',e,t),null})))},t.prototype.translationFormat=function(t){return t===s.FORMAT_XMB?s.FORMAT_XTB:t},t.prototype.mergeMasterTo=function(t,e){var r=this,n=k.fromFile(this.translationFormat(this.parameters.i18nFormat()),e,this.parameters.encoding(),this.parameters.optionalMasterFilePath(t)),a=t===this.parameters.defaultLanguage(),i=0,o=0,c=0,p=0,f=0;n.setNewTransUnitTargetPraefix(this.parameters.targetPraefix()),n.setNewTransUnitTargetSuffix(this.parameters.targetSuffix());var h=null;this.master.forEachTransUnit((function(t){var e=n.transUnitWithId(t.id),u=n.optionalMasterTransUnitWithId(t.id);if(!e&&u&&(e=u),e){if(e.supportsSetSourceContent()&&!r.areSourcesNearlyEqual(t,e)&&(e.setSourceContent(t.sourceContent()),a?(e.translate(t.sourceContent()),e.setTargetState(s.STATE_FINAL)):e.targetState()===s.STATE_FINAL&&e.setTargetState(s.STATE_TRANSLATED),o++),e.supportsSetSourceReferences()&&!r.areSourceReferencesEqual(t.sourceReferences(),e.sourceReferences())&&(e.setSourceReferences(t.sourceReferences()),c++),e.supportsSetDescriptionAndMeaning()){var l=!1;e.description()!==t.description()&&(e.setDescription(t.description()),l=!0),e.meaning()!==t.meaning()&&(e.setMeaning(t.meaning()),l=!0),l&&p++}h=e}else{var g=void 0;r.parameters.allowIdChange()&&(g=r.processChangedIdUnit(t,n,h))?(h=g,f++):(h=n.importNewTransUnit(t,a,r.parameters.useSourceAsTarget(),r.parameters.preserveOrder()?h:void 0),i++)}})),i>0&&this.commandOutput.warn('merged %s trans-units from master to "%s"',i,t),o>0&&this.commandOutput.warn('transferred %s changed source content from master to "%s"',o,t),c>0&&this.commandOutput.warn('transferred %s source references from master to "%s"',c,t),f>0&&this.commandOutput.warn('found %s changed id\'s in "%s"',f,t),p>0&&this.commandOutput.warn('transferred %s changed descriptions/meanings from master to "%s"',p,t);var g=0;return n.forEachTransUnit((function(t){!T(r.master.transUnitWithId(t.id))||(r.parameters.removeUnusedIds()&&n.removeTransUnitWithId(t.id),g++)})),g>0&&(this.parameters.removeUnusedIds()?this.commandOutput.warn('removed %s unused trans-units in "%s"',g,t):this.commandOutput.warn('keeping %s unused trans-units in "%s", because removeUnused is disabled',g,t)),0===i&&0===g&&0===o&&0===c&&0===p?(this.commandOutput.info('file for "%s" was up to date',t),u.of(null)):this.autoTranslate(this.master.sourceLanguage(),t,n).pipe(l.map((function(){return k.save(n,r.parameters.beautifyOutput()),r.commandOutput.info('updated file "%s" for target-language="%s"',e,t),i>0&&!a&&r.commandOutput.warn('please translate file "%s" to target-language="%s"',e,t),null})))},t.prototype.processChangedIdUnit=function(t,e,r){var n=this,a=null;if(e.forEachTransUnit((function(e){n.areSourcesNearlyEqual(e,t)&&(a=e)})),!a)return null;var i=e.importNewTransUnit(t,!1,!1,this.parameters.preserveOrder()?r:void 0),o=a.targetContent();return o&&(i.translate(o),i.setTargetState(s.STATE_TRANSLATED)),i},t.prototype.areSourcesNearlyEqual=function(t,e){if(t&&!e||e&&!t)return!1;var r=t.sourceContentNormalized(),n=e.sourceContentNormalized();return r.isICUMessage()?!!n.isICUMessage()&&r.getICUMessage().asNativeString().trim()===n.getICUMessage().asNativeString().trim():r.containsICUMessageRef()?r.asNativeString().trim()===n.asNativeString().trim():r.asDisplayString(s.NORMALIZATION_FORMAT_DEFAULT).trim()===n.asDisplayString(s.NORMALIZATION_FORMAT_DEFAULT).trim()},t.prototype.areSourceReferencesEqual=function(t,e){if(T(t)&&!T(e)||T(e)&&!T(t))return!1;if(T(t)&&T(e))return!0;var r=new Set;t.forEach((function(t){r.add(t.sourcefile+":"+t.linenumber)}));var n=new Set;if(e.forEach((function(t){n.add(t.sourcefile+":"+t.linenumber)})),r.size!==n.size)return!1;var a=!0;return n.forEach((function(t){r.has(t)||(a=!1)})),a},t.prototype.autoTranslate=function(t,e,r){var n=this,a=this.parameters.autotranslateLanguage(e);return(a?this.autoTranslateService.autoTranslate(t,e,r):u.of(new q(t,e))).pipe(l.map((function(t){return a&&(t.error()||t.failed()>0?n.commandOutput.error(t.content()):n.commandOutput.warn(t.content())),t})))},t}();t.CommandOutput=S,t.WriterToString=O,t.XliffMerge=z,t.XliffmergeModule=m,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-i18nsupport-ngx-i18nsupport.umd.min.js.map